<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Sample Usage Pixel Canvas</title>
    <script src="packages/web_components/platform.js"></script>
    <script src="packages/web_components/dart_support.js"></script>

    <link rel="import" href="packages/pixel_canvas/pixel_canvas.html">

    <script type="application/dart">
      import 'package:polymer/polymer.dart';
      import 'package:pixel_canvas/pixel_canvas.dart';
      import 'dart:html';

      main() {
        initPolymer();

        var inputColor = 'red';
        var mouseLeftButton = 1;
        bool isLeftButtonClick(MouseEvent e) =>
            mouseLeftButton == e.which;
        PixelCanvasElement canvas = querySelector('pixel-canvas');

        // handle isMouseDown

        bool isMouseDown = false;
        String drawnColor = null;
        handleMouseButton(PixelMouseEvent e) {
          MouseEvent me = e.origin;

          var newIsMouseDown = isLeftButtonClick(me);
          if (newIsMouseDown == isMouseDown) return;

          isMouseDown = newIsMouseDown;
          if (!newIsMouseDown) return;

          Pixel p = e.pixel;
          if (p.color == inputColor) {
            drawnColor = null;
          } else {
            drawnColor = inputColor;
          }
        }
        canvas
            ..onPixelMouseMove.listen(handleMouseButton)
            ..onPixelMouseDown.listen(handleMouseButton)
            ..onPixelMouseUp.listen((e){
              MouseEvent me = e.origin;
              if (!isLeftButtonClick(me)) return;
              isMouseDown = false;
            });

        // drawing

        draw(PixelMouseEvent e) {
          Pixel p = e.pixel;
          p.color = drawnColor;
        }
        canvas
            ..onPixelMouseDown.listen(draw)
            ..onPixelMouseOver.listen((e) {
              if (!isMouseDown) return;
              draw(e);
            });

        // logging

        canvas
          ..onBeforeRendering.listen((e) => print('render'))
          ..onPixelColorChange.listen((e) =>
              print('change color [ ${e.pixel}, oldColor: ${e.oldColor}]'));

        // download button

        querySelector('#download-as-png')
          ..onClick.listen((e) =>
              canvas.downloadAs('pixel-canvas-sample.png'));
      }
    </script>
  </head>
  <body bgcolor="#ccc">

    <p><a href="https://github.com/kui/pixel_canvas/blob/master/example/drawing_with_drag.html">Source code</a>

    <p>Click or drag pixels</p>

    <!-- -----------------------------------------
      Sample
    ------------------------------------------ -->
    <pixel-canvas verticalPixels="10" horizontalPixels="10" PixelSize="50">
      [
        ["green"],
        ["red", null, "blue"],
        ["rgb(255, 128, 128)", "rgb(128, 255, 128)", "rgb(128, 128, 255)"],
        [null, null, "#f00", "#333", "#ffffff", "#abab00"],
        null,
        [],
        ["", ""],
        ["rgba(0, 255, 255, 0.2)",
         "rgba(0, 255, 255, 0.4)",
         "rgba(0, 255, 255, 0.6)",
         "rgba(0, 255, 255, 0.8)",
         "rgba(0, 255, 255, 1.0)"]
      ]
    </pixel-canvas>
    <button id="download-as-png">Download as PNG</button>
  </body>
</html>
